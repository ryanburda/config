# Uncomment to profile zsh startup.
# NOTE: must also uncomment last line.
# zmodload zsh/zprof

# Automatically start a tmux session
# if [ "$TMUX" = "" ]; then tmux; fi

# Set the command history to a very high value and add to the history immediately.
export HISTFILESIZE=1000000000
export HISTSIZE=1000000000
setopt INC_APPEND_HISTORY
export HISTTIMEFORMAT="[%F %T] "

# Set default editor
export EDITOR=nvim

# Add to PATH
path+=$HOME/.local/bin
path+=$HOME/.local/bin/neovim/bin
fpath+=$HOME/.zsh/compdef/

# Pure theme
fpath+=/opt/homebrew/share/zsh/site-functions
autoload -U promptinit; promptinit
zstyle :prompt:pure:git:stash show yes
prompt pure

# Source zsh plugins
if type brew &>/dev/null; then
    FPATH=$(brew --prefix)/share/zsh-completions:$FPATH
    autoload -Uz compinit
    compinit -i
    zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
fi
source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh
source $(brew --prefix)/opt/zsh-vi-mode/share/zsh-vi-mode/zsh-vi-mode.plugin.zsh
source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source $(brew --prefix)/opt/zsh-history-substring-search/share/zsh-history-substring-search/zsh-history-substring-search.zsh
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down

# Alias
alias ls="ls --color=always -lah"
alias vim="nvim"
alias h="cht.sh"
alias top="htop"
alias s="tmuxinator start"
alias rg="rg -L"

# fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# google-cloud-sdk completions
source "$(brew --prefix)/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.zsh.inc"

# python
path+=$HOME/.pyenv/bin
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"

# Raise max files and max procs
ulimit -n 200000
ulimit -u 2048

# ChatGPT
OPENAI_API_KEY_FILE=$HOME/.openai_api_key
if [ -f $OPENAI_API_KEY_FILE ]; then
    export OPENAI_API_KEY=$(cat $OPENAI_API_KEY_FILE)
else
    export OPENAI_API_KEY=""
fi

# Uncomment to profile zsh startup.
# NOTE: must also uncomment first line.
# zprof
