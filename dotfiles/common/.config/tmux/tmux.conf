# Remove custom keybinds before reapplying.
unbind-key -a

# Prefix
unbind C-b
unbind Space
set-option -g prefix C-Space

# Options
set-option -g default-terminal "${TERM}"
set-option -g status-position bottom
set-option -g status-style "fg=default,bg=default"
set-option -g automatic-rename off
set-option -g pane-border-lines heavy
set-option -g pane-border-indicators both
set-option -g pane-border-style "fg=black"
set-option -g pane-active-border-style "fg=green"
set-option -g popup-border-lines rounded
set-option -g detach-on-destroy off
set-option -s exit-unattached off
set-option -g display-time 2000
set-option -g repeat-time 500
set-option -g escape-time 0
set-option -g focus-events on
set-option -g mode-keys vi
set-option -g base-index 1
set-option -g pane-base-index 1
set-option -g renumber-windows on
set-option -as terminal-features ",*:RGB"
set-option -ag terminal-overrides ",xterm-256color:RGB"
set-option -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set-option -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colors
set-window-option -g mouse on
# Status bar
set-option -g status-justify centre
set-option -g window-status-format " #[dim]#I:#W "
set-option -g window-status-current-format "#[bold] #I:#W "
set-option -g status-left-length 61
set-option -g status-left ' #(printf "%%-60s" "#S")'
set-option -g status-right-length 61
set-option -g status-right '#(printf "%%60s" "UTC$(date +%%z) $(TZ=UTC date -u +%%m-%%d\ %%H:%%M)") '

# Keybinds
bind-key . source-file "${XDG_CONFIG_HOME}/tmux/tmux.conf" \; display "tmux conf reloaded!"
bind-key : command-prompt
bind-key ? list-keys
bind-key Space copy-mode
bind-key Enter attach-session -c "#{pane_current_path}"
bind-key t new-window -c "#{pane_current_path}"
bind-key \; split-window -v -p 20 -c "#{pane_current_path}"
bind-key "'" split-window -h -p 30 -c "#{pane_current_path}"
bind-key x kill-pane
bind-key b break-pane
bind-key p popup -h 50% -w 50%
bind-key m popup -h 11 -w 68 "cal -3"
bind-key , popup -E "settings"
# Windows
bind-key j select-window -t 1
bind-key k select-window -t 2
bind-key l select-window -t 3
bind-key d run-shell "tmux_toggle_window docker lazydocker"
bind-key g run-shell "tmux_toggle_window git lazygit"
bind-key -r i previous-window
bind-key -r o next-window
bind-key -r I swap-window -t -1 \; select-window -t -1
bind-key -r O swap-window -t +1 \; select-window -t +1
# Sessions
bind-key Tab switch-client -l
bind-key s popup -E "tsm"
bind-key c popup -E "tsm -c"
bind-key D popup -E "tsm -d"
bind-key K popup -E "tsm -k"
bind-key w popup -E "tsm -w"
bind-key L run-shell "tmux_toggle_window tsm_logs tsm -l"
bind-key X run-shell "tsm -k #{session_name}"

################
# nvim-tmux-wm #
################
# NOTE: Update the path to match where you cloned this plugin (This should work for lazy.nvim)
#         |
#         |
#         V
# NVIM_TMUX_RESIZE_SCRIPT="$HOME/.local/share/nvim/lazy/nvim-tmux-wm/scripts/resize_tmux_pane.sh"
NVIM_TMUX_RESIZE_SCRIPT="$HOME/Developer/nvim-tmux-wm/scripts/resize_tmux_pane.sh"

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"

# Navigation bindings
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

# Resize bindings
# Amounts work like a coordinate plane: positive numbers move the border right/up, negative numbers move it left/down.
bind-key -n 'M-h' if-shell "$is_vim" 'send-keys M-h' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT h -3'"
bind-key -n 'M-H' if-shell "$is_vim" 'send-keys M-H' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT h  3'"
bind-key -n 'M-j' if-shell "$is_vim" 'send-keys M-j' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT j -1'"
bind-key -n 'M-J' if-shell "$is_vim" 'send-keys M-J' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT j  1'"
bind-key -n 'M-k' if-shell "$is_vim" 'send-keys M-k' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT k  1'"
bind-key -n 'M-K' if-shell "$is_vim" 'send-keys M-K' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT k -1'"
bind-key -n 'M-l' if-shell "$is_vim" 'send-keys M-l' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT l  3'"
bind-key -n 'M-L' if-shell "$is_vim" 'send-keys M-L' "run-shell -b '$NVIM_TMUX_RESIZE_SCRIPT l -3'"

# Legacy tmux version support for navigation
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

# Copy mode bindings
bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
####################
# end nvim-tmux-wm #
####################
