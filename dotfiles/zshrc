#!/bin/zsh
# Uncomment to profile zsh startup.
# NOTE: must also uncomment last line.
# zmodload zsh/zprof

export PATH="/usr/local/sbin:$PATH"

PROMPT="%B%F{yellow}%n %F{cyan}%~"$'\n'"%F{yellow}> %b"

# Case insensitive completion
autoload -Uz compinit && compinit
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'

# Set the command history to a very high value and add to the history immediately.
export HISTFILESIZE=1000000000
export HISTSIZE=1000000000
setopt INC_APPEND_HISTORY
setopt auto_cd
export HISTTIMEFORMAT="[%F %T] "
export XDG_CONFIG_HOME=$HOME/.config
export FZF_DEFAULT_OPTS="--history=$HOME/.fzf_history_dir $FZF_DEFAULT_OPTS"
export FZF_HISTORY_DIR=1

# Set default editor and pager
if [[ "$(command -v nvim)" ]]; then
    export EDITOR='nvim'
    export MANPAGER='nvim +Man!'
    export MANWIDTH=999
fi

# Add to PATH
fpath+=$HOME/.zsh/compdef/
fpath+=$HOME/.zsh/funcs/
autoload -U ~/.zsh/funcs/find_file
autoload -U ~/.zsh/funcs/tse
autoload -U ~/.zsh/funcs/nvim_open
autoload -U ~/.zsh/funcs/select_session
autoload -U ~/.zsh/funcs/set_font
autoload -U ~/.zsh/funcs/font_picker
autoload -U ~/.zsh/funcs/theme_picker
autoload -U ~/.zsh/funcs/psqlp

# autocompletion using arrow keys (based on history)
bindkey '^[[A' history-search-backward
bindkey '^[[B' history-search-forward

# Alias
alias l="lsd -lah"
alias a="aichat"
alias s="select_session"
alias d="lazydocker"
alias g="lazygit"
alias t="btm"
alias f="font_picker"
alias c="theme_picker"
alias m="cal -A 1 -B 1"
alias db="nvim -c \"lua require('dbee').open()\""

# fzf
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# google-cloud-sdk completions
source "$(brew --prefix)/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/completion.zsh.inc"

# python
path+=$HOME/.pyenv/bin
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"

# Raise max files and max procs
ulimit -n 200000
ulimit -u 2048

# ChatGPT
OPENAI_API_KEY_FILE=$HOME/.openai_api_key
if [ -f $OPENAI_API_KEY_FILE ]; then
    export OPENAI_API_KEY=$(cat $OPENAI_API_KEY_FILE)
else
    export OPENAI_API_KEY=""
fi

source $(brew --prefix)/opt/zsh-vi-mode/share/zsh-vi-mode/zsh-vi-mode.plugin.zsh
source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source $(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh

# Uncomment to profile zsh startup.
# NOTE: must also uncomment first line.
# zprof
